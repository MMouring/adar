AWSTemplateFormatVersion: '2010-09-09'
Transform: 
  - AWS::Serverless-2016-10-31
  - AWS::LanguageExtensions
Description: Google Ads Editor StackSet

Parameters:
  debug:
    Type: String
    Default: False
  stage:
    Type: String
    Default: dev
    AllowedValues:
      - dev
      - stage
      - prod
  googleAdsRefreshToken:
    Type: String
    Default: 1/PJnkY44BT-NZN6eCJFTbebDG1eCWMpeDhREkJ6W6C9I
  googleAdsClientId:
    Type: String
    Default: 1031328113312-7881pntatrqo07idt3nk09euooo232t1.apps.googleusercontent.com
  googleAdsClientSecret:
    Type: String
    Default: 5UtS9UWDA2vqzMfujOhiprOG
  googleAdsDeveloperToken:
    Type: String
    Default: jh6jxvQqjtPGMfpd8Z1DgA
  googleAdsLoginCustomerId:
    Type: String
    Default: 7864081494
  
Conditions:
  CreateProdResources: !Equals [ !Ref stage, prod ]

Mappings:
  Layers:
    stage:
      GoogleAdsLayer: 'arn:aws:lambda:us-east-1:275193884268:layer:google-ads-layer:4'
      BingAdsLayer: 'arn:aws:lambda:us-east-1:275193884268:layer:bing-ads-layer:4'
    prod:
      GoogleAdsLayer: 'arn:aws:lambda:us-east-1:170865245687:layer:google-ads-layer:1'
      BingAdsLayer: 'arn:aws:lambda:us-east-1:170865245687:layer:bing-ads-layer:1'
    dev:
      GoogleAdsLayer: 'arn:aws:lambda:us-east-1:275193884268:layer:google-ads-layer:1'
      BingAdsLayer: 'arn:aws:lambda:us-east-1:275193884268:layer:bing-ads-layer:1'

Resources:
  GoogleAdsEditorCustomerConversionLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-customer-conversion
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAdGroupPerformanceLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-ad-group-performance
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAdPerformanceLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-ad-performance
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorKeywordPerformanceLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-keyword-performance
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAccountLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-account
      RetentionInDays: 7
  GoogleAdsEditorAccountLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAccount]}
      RetentionInDays: 7
  GoogleAdsEditorAccountLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAccountLog]}
      RetentionInDays: 7
  GoogleAdsEditorAdLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-ad
      RetentionInDays: 7
  GoogleAdsEditorAdLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAd]}
      RetentionInDays: 7
  GoogleAdsEditorAdLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAdLog]}
      RetentionInDays: 7
  GoogleAdsEditorAdGroupLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-ad-group
      RetentionInDays: 7
  GoogleAdsEditorAdGroupLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroup]}
      RetentionInDays: 7
  GoogleAdsEditorAdGroupLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroupLog]}
      RetentionInDays: 7
  GoogleAdsEditorCampaignLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-campaign
      RetentionInDays: 7
  GoogleAdsEditorCampaignLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleCampaign]}
      RetentionInDays: 7
  GoogleAdsEditorCampaignLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleCampaignLog]}
      RetentionInDays: 7
  GoogleAdsEditorAssetLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-asset
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAssetLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAsset]}
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAssetLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAssetLog]}
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAssetSetLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-asset-set
      RetentionInDays: 7
  GoogleAdsEditorAssetSetLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSet]}
      RetentionInDays: 7
  GoogleAdsEditorAssetSetLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSetLog]}
      RetentionInDays: 7
  GoogleAdsEditorFeedLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-feed
      RetentionInDays: 7
  GoogleAdsEditorFeedLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeed]}
      RetentionInDays: 7
  GoogleAdsEditorFeedLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeedLog]}
      RetentionInDays: 7
  GoogleAdsEditorFeedItemLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-feed-item
      RetentionInDays: 7
  GoogleAdsEditorFeedItemLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItem]}
      RetentionInDays: 7
  GoogleAdsEditorFeedItemLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItemLog]}
      RetentionInDays: 7
  GoogleAdsEditorKeywordLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-keyword
      RetentionInDays: 7
  GoogleAdsEditorKeywordLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleKeyword]}
      RetentionInDays: 7
  GoogleAdsEditorKeywordLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleKeywordLog]}
      RetentionInDays: 7
  GoogleAdsEditorSharedSetLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-shared-set
      RetentionInDays: 7
  GoogleAdsEditorSharedSetLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSet]}
      RetentionInDays: 7
  GoogleAdsEditorSharedSetLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetLog]}
      RetentionInDays: 7
  GoogleAdsEditorSharedSetKeywordLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/google-ads-editor-shared-set-keyword
      RetentionInDays: 7
  GoogleAdsEditorSharedSetKeywordLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeyword]}
      RetentionInDays: 7
  GoogleAdsEditorSharedSetKeywordLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeywordLog]}
      RetentionInDays: 7
  GoogleAdsEditorRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - lambda.amazonaws.com
            Action:
              - sts:AssumeRole
      Policies:
        - PolicyName: custom
          PolicyDocument:
            Version: 2012-10-17
            Statement:
              - Effect: Allow
                Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:DescribeLogStreams
                  - logs:PutLogEvents
                Resource: arn:aws:logs:*:*:*
              - Effect: Allow
                Action:
                  - lambda:InvokeFunction
                Resource: '*'
              - Effect: Allow
                Action:
                  - sns:Publish
                Resource: '*'
              - Effect: Allow
                Action:
                  - firehose:PutRecord
                  - firehose:PutRecordBatch
                Resource: '*'
              - Effect: Allow
                Action:
                  - dynamodb:BatchWriteItem
                  - dynamodb:DeleteItem
                  - dynamodb:GetItem
                  - dynamodb:PutItem
                  - dynamodb:Query
                  - dynamodb:Scan
                  - dynamodb:UpdateItem
                  - dynamodb:GetRecords
                  - dynamodb:GetShardIterator
                  - dynamodb:DescribeStream
                  - dynamodb:ListStreams
                Resource: '*'
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                Resource: arn:aws:s3:::*
              - Effect: Allow
                Action:
                  - kms:Decrypt
                  - kms:GenerateDataKey
                Resource: !ImportValue KmsKeyArn
      RoleName: !Sub google-ads-editor

  GoogleAdsEditorAdPerformanceLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-ad-performance
      Description: Google Ad Performance Report
      Handler: ad_performance_repot_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorCustomerConversionLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-customer-conversion
      Description: Google Customer Conversion Check
      Handler: customer_conversion_report_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorAdGroupPerformanceLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-ad-group-performance
      Description: Google Ad Group Performance Report
      Handler: ad_group_performance_report_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorKeywordPerformanceLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-keyword-performance
      Description: Google Keyword Performance Report
      Handler: keyword_performance_report_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorAccountLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-account
      Description: Updates Google Ads Accounts
      Handler: account_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_ACCOUNT: !FindInMap [Kinesis, DeliveryStreamName, GoogleAccount]
          GOOGLE_ACCOUNT_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleAccountLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorAdLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-ad
      Description: Updates Google Ads Ads
      Handler: ad_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_AD: !FindInMap [Kinesis, DeliveryStreamName, GoogleAd]
          GOOGLE_AD_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleAdLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorAdGroupLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-ad-group
      Description: Updates Google Ads Ad Groups
      Handler: ad_group_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_AD_GROUP: !FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroup]
          GOOGLE_AD_GROUP_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroupLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorCampaignLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-campaign
      Description: Updates Google Ads Campaigns
      Handler: campaign_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_CAMPAIGN: !FindInMap [Kinesis, DeliveryStreamName, GoogleCampaign]
          GOOGLE_CAMPAIGN_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleCampaignLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorKeywordLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-keyword
      Description: Updates Google Ads Keywords
      Handler: ad_group_keyword_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_KEYWORD: !FindInMap [Kinesis, DeliveryStreamName, GoogleKeyword]
          GOOGLE_KEYWORD_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleKeywordLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorSharedSetLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-shared-set
      Description: Updates Google Ads Shared Sets
      Handler: shared_set_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_SHARED_SET: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSet]
          GOOGLE_SHARED_SET_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorSharedSetKeywordLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-shared-set-keyword
      Description: Updates Google Ads Shared Set Keywords
      Handler: shared_set_criterion_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_SHARED_SET_KEYWORD: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeyword]
          GOOGLE_SHARED_SET_KEYWORD_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeywordLog]
          
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorAssetLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-asset
      Description: Updates Google Ads Assets
      Handler: asset_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_ASSET: !FindInMap [Kinesis, DeliveryStreamName, GoogleAsset]
          GOOGLE_ASSET_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleAssetLog]
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorAssetSetLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-asset-set
      Description: Updates Google Ads AssetSets
      Handler: asset_set_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_ASSET_SET: !FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSet]
          GOOGLE_ASSET_SET_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSetLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorFeedLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-feed
      Description: Updates Google Ads Feeds
      Handler: feed_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_FEED: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeed]
          GOOGLE_FEED_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeedLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorFeedItemLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub google-ads-editor-feed-item
      Description: Updates Google Ads Feed Items
      Handler: feed_item_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
          GOOGLE_FEED_ITEM: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItem]
          GOOGLE_FEED_ITEM_LOG: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItemLog]
      Layers:
        - !FindInMap [Layers, !Ref stage, GoogleAdsLayer]
        - !FindInMap [Layers, !Ref stage, BingAdsLayer]

  GoogleAdsEditorAdPerformanceAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdPerformanceLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdPerformanceAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdPerformanceLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorCustomerConversionAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCustomerConversionLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorCustomerConversionAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCustomerConversionLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAdGroupPerformanceAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupPerformanceLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdGroupPerformanceAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupPerformanceLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorKeywordPerformanceAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordPerformanceLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorKeywordPerformanceAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordPerformanceLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAccountAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAccountLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAccountAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAccountLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAdAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAdGroupAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdGroupAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorCampaignAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCampaignLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorCampaignAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCampaignLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAssetAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAssetAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAssetSetAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetSetLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAssetSetAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetSetLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorFeedAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorFeedAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorFeedItemAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedItemLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorFeedItemAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedItemLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorKeywordAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorKeywordAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorSharedSetAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorSharedSetAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorSharedSetKeywordAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetKeywordLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorSharedSetKeywordAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetKeywordLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAccountFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !Ref googleAccount
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${googleAccount}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/account/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/account/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAccountLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAccountLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAccountLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/account-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/account-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAd]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAd]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAdLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAdLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorCampaignFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleCampaign]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleCampaign]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/campaign/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/campaign/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorCampaignLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleCampaignLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleCampaignLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/campaign-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/campaign-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdGroupFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroup]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroup]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad-group/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad-group/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdGroupLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroupLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAdGroupLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad-group-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad-group-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAssetFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAsset]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAsset]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i

  GoogleAdsEditorAssetLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAssetLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAssetLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i

  GoogleAdsEditorAssetSetFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSet]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSet]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset-set/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset-set/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAssetSetLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSetLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleAssetSetLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset-set-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset-set-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeed]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeed]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeedLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeedLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedItemFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItem]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItem]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed-item/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed-item/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedItemLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItemLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleFeedItemLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed-item-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed-item-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorKeywordFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleKeyword]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleKeyword]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/keyword/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/keyword/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorKeywordLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleKeywordLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleKeywordLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/keyword-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/keyword-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSet]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSet]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetKeywordFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeyword]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeyword]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set-keyword/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set-keyword/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetKeywordLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: !FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeywordLog]
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: !Sub /aws/kinesisfirehose/${!FindInMap [Kinesis, DeliveryStreamName, GoogleSharedSetKeywordLog]}
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set-keyword-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set-keyword-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: !Sub 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAccountEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_account/stream/2019-11-11T18:32:09.876'
      FunctionName:
        Ref : GoogleAdsEditorAccountAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAccountErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-account lambda'
      AlarmName: google-ads-editor-account-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-account
        - Name: Resource
          Value: !Sub google-ads-editor-account:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAdEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_ad/stream/2019-10-01T17:16:31.643'
      FunctionName:
        Ref : GoogleAdsEditorAdAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAdErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-ad lambda'
      AlarmName: google-ads-editor-ad-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-ad
        - Name: Resource
          Value: !Sub google-ads-editor-ad:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAdGroupEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_ad_group/stream/2019-09-26T15:35:28.502'
      FunctionName:
        Ref : GoogleAdsEditorAdGroupAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAdGroupErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-ad-group lambda'
      AlarmName: google-ads-editor-ad-group-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-ad-group
        - Name: Resource
          Value: !Sub google-ads-editor-ad-group:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorCampaignEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_campaign/stream/2019-10-24T20:32:48.705'
      FunctionName:
        Ref : GoogleAdsEditorCampaignAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorCampaignErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-campaign lambda'
      AlarmName: google-ads-editor-campaign-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-campaign
        - Name: Resource
          Value: !Sub google-ads-editor-campaign:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAssetEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_asset/stream/2022-05-10T14:06:27.602'
      FunctionName:
        Ref : GoogleAdsEditorAssetAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAssetErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-asset lambda'
      AlarmName: google-ads-editor-asset-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-asset
        - Name: Resource
          Value: !Sub google-ads-editor-asset:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAssetSetEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_asset_set/stream/2022-05-15T13:14:05.887'
      FunctionName:
        Ref : GoogleAdsEditorAssetSetAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAssetSetErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-asset-set lambda'
      AlarmName: google-ads-editor-asset-set-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-asset-set
        - Name: Resource
          Value: !Sub google-ads-editor-asset-set:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorFeedEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_feed/stream/2020-02-06T19:38:26.262'
      FunctionName:
        Ref : GoogleAdsEditorFeedAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorFeedErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-feed lambda'
      AlarmName: google-ads-editor-feed-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-feed
        - Name: Resource
          Value: !Sub google-ads-editor-feed:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorFeedItemEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_feed_item/stream/2020-02-06T19:38:22.730'
      FunctionName:
        Ref : GoogleAdsEditorFeedItemAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorFeedItemErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-feed-item lambda'
      AlarmName: google-ads-editor-feed-item-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-feed-item
        - Name: Resource
          Value: !Sub google-ads-editor-feed-item:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorKeywordEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_keyword/stream/2019-09-26T15:35:24.330'
      FunctionName:
        Ref : GoogleAdsEditorKeywordAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorKeywordErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-keyword lambda'
      AlarmName: google-ads-editor-keyword-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-keyword
        - Name: Resource
          Value: !Sub google-ads-editor-keyword:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorSharedSetEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_shared_set/stream/2019-09-12T16:17:57.853'
      FunctionName:
        Ref : GoogleAdsEditorSharedSetAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorSharedSetErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-shared-set lambda'
      AlarmName: google-ads-editor-shared-set-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-shared-set
        - Name: Resource
          Value: !Sub google-ads-editor-shared-set:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorSharedSetKeywordEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: !Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/google_shared_set_keyword/stream/2019-09-12T16:17:54.640'
      FunctionName:
        Ref : GoogleAdsEditorSharedSetKeywordAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorSharedSetKeywordErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-shared-set-keyword lambda'
      AlarmName: google-ads-editor-shared-set-keyword-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-shared-set-keyword
        - Name: Resource
          Value: !Sub google-ads-editor-shared-set-keyword:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorCustomerConversionEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads customer conversion report from Google Ads and reports issues
      Name: google-customer-conversion-report
      ScheduleExpression: cron(0 21 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorCustomerConversionAliasProd
        Id: google-customer-conversion-report
        Input: '{"daysAgo" : 1}'
  GoogleAdsEditorAdGroupPerformanceCurrentEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads today's ad group performance report from Google Ads
      Name: google-ad-group-performance-report-current
      ScheduleExpression: cron(0/21 0,1,2,3,12,13,14,15,16,17,18,19,20,21,22,23 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorAdGroupPerformanceAliasProd 
        Id: google-ad-group-performance-report
        Input: '{"daysAgo" : 0}'
  GoogleAdsEditorAdGroupPerformanceEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads ad group performance report from Google Ads
      Name: google-ad-group-performance-report
      ScheduleExpression: cron(0 11 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorAdGroupPerformanceAliasProd
        Id: google-ad-group-performance-report
        Input: '{"daysAgo" : 1}'
  GoogleAdsEditorAdPerformanceEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads ad performance report from Google Ads
      Name: google-ad-performance-report
      ScheduleExpression: cron(0 11 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorAdPerformanceAliasProd 
        Id: google-ad-performance-report
        Input: '{"daysAgo" : 1}'
    Type: AWS::Events::Rule
  GoogleAdsEditorKeywordPerformanceEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads keyword performance report from Google Ads
      Name: google-keyword-performance-report
      ScheduleExpression: cron(0 11 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorKeywordPerformanceAliasProd
        Id: google-keyword-performance-report
        Input: '{"daysAgo" : 1}'
    Type: AWS::Events::Rule
  GoogleAdsEditorCustomerConversionLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorCustomerConversionAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorCustomerConversionEvent
        - Arn
  GoogleAdsEditorAdGroupPerformanceCurrentLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorAdGroupPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorAdGroupPerformanceCurrentEvent 
        - Arn
  GoogleAdsEditorAdGroupPerformanceLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorAdGroupPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorAdGroupPerformanceEvent
        - Arn
  GoogleAdsEditorAdPerformanceLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorAdPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorAdPerformanceEvent
        - Arn
  GoogleAdsEditorKeywordPerformanceLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorKeywordPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorKeywordPerformanceEvent
        - Arn

  GoogleAdsEditorAdGroupPerformanceErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on googleAdsEditorAdGroupPerformance lambda'
      AlarmName: google-ads-editor-ad-group-performance-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-ad-group-performance
        - Name: Resource
          Value: !Sub google-ads-editor-ad-group-performance:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 3600
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAdPerformanceErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-ad-performance lambda'
      AlarmName: google-ads-editor-ad-performance-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-ad-performance
        - Name: Resource
          Value: !Sub google-ads-editor-ad-performance:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 3600
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorKeywordPerformanceErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - !Sub 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:PublicAlert'
      AlarmDescription: 'Failure on google-ads-editor-keyword-performance lambda'
      AlarmName: google-ads-editor-keyword-performance-failure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub google-ads-editor-keyword-performance
        - Name: Resource
          Value: !Sub google-ads-editor-keyword-performance:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 3600
      Statistic: Maximum
      Threshold: 0
      Unit: Count
