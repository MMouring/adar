AWSTemplateFormatVersion: '2010-09-09'
Transform: 
  - AWS::Serverless-2016-10-31
  - AWS::LanguageExtensions
Description: Google Ads Editor StackSet

Parameters:
  debug:
    Type: String
    Default: False
  stage:
    Type: String
    Default: dev
    AllowedValues:
      - dev
      - stage
      - prod
  googleAdsRefreshToken:
    Type: String
    Default: 1/PJnkY44BT-NZN6eCJFTbebDG1eCWMpeDhREkJ6W6C9I
  googleAdsClientId:
    Type: String
    Default: 1031328113312-7881pntatrqo07idt3nk09euooo232t1.apps.googleusercontent.com
  googleAdsClientSecret:
    Type: String
    Default: 5UtS9UWDA2vqzMfujOhiprOG
  googleAdsDeveloperToken:
    Type: String
    Default: jh6jxvQqjtPGMfpd8Z1DgA
  googleAdsLoginCustomerId:
    Type: String
    Default: 7864081494
  
Conditions:
  CreateProdResources: !Equals [ !Ref stage, prod ]

Mappings:
  LayerVersions:
    stage:
      GoogleAdsLayerVersion: 2
      BingAdsLayerVersion: 2
    prod:
      GoogleAdsLayerVersion: 1
      BingAdsLayerVersion: 1
    dev:
      GoogleAdsLayerVersion: 2
      BingAdsLayerVersion: 2

Resources:
  GoogleAdsEditorCustomerConversionLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorCustomerConversionV1
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAdGroupPerformanceLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorAdGroupPerformanceV1
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAdPerformanceLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorAdPerformanceV1
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorKeywordPerformanceLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorKeywordPerformanceV1
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAccountLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorAccountV1
      RetentionInDays: 7
  GoogleAdsEditorAccountLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAccount
      RetentionInDays: 7
  GoogleAdsEditorAccountLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAccountLog
      RetentionInDays: 7
  GoogleAdsEditorAdLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorAdV1
      RetentionInDays: 7
  GoogleAdsEditorAdLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAd
      RetentionInDays: 7
  GoogleAdsEditorAdLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAdLog
      RetentionInDays: 7
  GoogleAdsEditorAdGroupLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorAdGroupV1
      RetentionInDays: 7
  GoogleAdsEditorAdGroupLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAdGroup
      RetentionInDays: 7
  GoogleAdsEditorAdGroupLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAdGroupLog
      RetentionInDays: 7
  GoogleAdsEditorCampaignLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorCampaignV1
      RetentionInDays: 7
  GoogleAdsEditorCampaignLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleCampaign
      RetentionInDays: 7
  GoogleAdsEditorCampaignLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleCampaignLog
      RetentionInDays: 7
  GoogleAdsEditorAssetLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorAssetV1
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAssetLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAsset
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAssetLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAssetLog
      RetentionInDays: 7
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i
  GoogleAdsEditorAssetSetLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorAssetSetV1
      RetentionInDays: 7
  GoogleAdsEditorAssetSetLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAssetSet
      RetentionInDays: 7
  GoogleAdsEditorAssetSetLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleAssetSetLog
      RetentionInDays: 7
  GoogleAdsEditorFeedLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorFeedV1
      RetentionInDays: 7
  GoogleAdsEditorFeedLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleFeed
      RetentionInDays: 7
  GoogleAdsEditorFeedLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleFeedLog
      RetentionInDays: 7
  GoogleAdsEditorFeedItemLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorFeedItemV1
      RetentionInDays: 7
  GoogleAdsEditorFeedItemLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleFeedItem
      RetentionInDays: 7
  GoogleAdsEditorFeedItemLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleFeedItemLog
      RetentionInDays: 7
  GoogleAdsEditorKeywordLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorKeywordV1
      RetentionInDays: 7
  GoogleAdsEditorKeywordLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleKeyword
      RetentionInDays: 7
  GoogleAdsEditorKeywordLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleKeywordLog
      RetentionInDays: 7
  GoogleAdsEditorSharedSetLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorSharedSetV1
      RetentionInDays: 7
  GoogleAdsEditorSharedSetLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleSharedSet
      RetentionInDays: 7
  GoogleAdsEditorSharedSetLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleSharedSetLog
      RetentionInDays: 7
  GoogleAdsEditorSharedSetKeywordLambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/googleAdsEditorSharedSetKeywordV1
      RetentionInDays: 7
  GoogleAdsEditorSharedSetKeywordLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleSharedSetKeyword
      RetentionInDays: 7
  GoogleAdsEditorSharedSetKeywordLogLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: /aws/kinesisfirehose/googleSharedSetKeywordLog
      RetentionInDays: 7
  GoogleAdsEditorRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - lambda.amazonaws.com
            Action:
              - sts:AssumeRole
      Policies:
        - PolicyName: custom
          PolicyDocument:
            Version: 2012-10-17
            Statement:
              - Effect: Allow
                Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:DescribeLogStreams
                  - logs:PutLogEvents
                Resource: arn:aws:logs:*:*:*
              - Effect: Allow
                Action:
                  - lambda:InvokeFunction
                Resource: '*'
              - Effect: Allow
                Action:
                  - sns:Publish
                Resource: '*'
              - Effect: Allow
                Action:
                  - firehose:PutRecord
                  - firehose:PutRecordBatch
                Resource: '*'
              - Effect: Allow
                Action:
                  - dynamodb:BatchWriteItem
                  - dynamodb:DeleteItem
                  - dynamodb:GetItem
                  - dynamodb:PutItem
                  - dynamodb:Query
                  - dynamodb:Scan
                  - dynamodb:UpdateItem
                  - dynamodb:GetRecords
                  - dynamodb:GetShardIterator
                  - dynamodb:DescribeStream
                  - dynamodb:ListStreams
                Resource: '*'
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                Resource: arn:aws:s3:::*
      RoleName: !Sub google-ads-editor-V1-

  GoogleAdsEditorAdPerformanceLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorAdPerformanceV1
      Description: Google Ad Performance Report
      Handler: ad_performance_repot_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorCustomerConversionLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorCustomerConversionV1
      Description: Google Customer Conversion Check
      Handler: customer_conversion_report_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorAdGroupPerformanceLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorAdGroupPerformanceV1
      Description: Google Ad Group Performance Report
      Handler: ad_group_performance_report_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorKeywordPerformanceLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorKeywordPerformanceV1
      Description: Google Keyword Performance Report
      Handler: keyword_performance_report_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 4096
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorAccountLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorAccountV1
      Description: Updates Google Ads Accounts
      Handler: account_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorAdLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorAdV1
      Description: Updates Google Ads Ads
      Handler: ad_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorAdGroupLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorAdGroupV1
      Description: Updates Google Ads Ad Groups
      Handler: ad_group_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorCampaignLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorCampaignV1
      Description: Updates Google Ads Campaigns
      Handler: campaign_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorKeywordLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorKeywordV1
      Description: Updates Google Ads Keywords
      Handler: ad_group_keyword_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorSharedSetLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorSharedSetV1
      Description: Updates Google Ads Shared Sets
      Handler: shared_set_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorSharedSetKeywordLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorSharedSetKeywordV1
      Description: Updates Google Ads Shared Set Keywords
      Handler: shared_set_criterion_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorAssetLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorAssetV1
      Description: Updates Google Ads Assets
      Handler: asset_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Tags:
        map-migrated: d-server-0172k7rzjqh68i
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorAssetSetLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorAssetSetV1
      Description: Updates Google Ads AssetSets
      Handler: asset_set_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorFeedLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorFeedV1
      Description: Updates Google Ads Feeds
      Handler: feed_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorFeedItemLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub googleAdsEditorFeedItemV1
      Description: Updates Google Ads Feed Items
      Handler: feed_item_lambda.handler
      Runtime: python3.13
      CodeUri: ./src
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - GoogleAdsEditorRole
          - Arn
      Timeout: 900
      Environment:
        Variables:
          DEBUG: !Sub ${debug}
          GOOGLE_ADS_REFRESH_TOKEN: !Sub ${googleAdsRefreshToken}
          GOOGLE_ADS_CLIENT_ID: !Sub ${googleAdsClientId}
          GOOGLE_ADS_CLIENT_SECRET: !Sub ${googleAdsClientSecret}
          GOOGLE_ADS_DEVELOPER_TOKEN: !Sub ${googleAdsDeveloperToken}
          GOOGLE_ADS_LOGIN_CUSTOMER_ID: !Sub ${googleAdsLoginCustomerId}
          GOOGLE_ADS_USE_PROTO_PLUS: true
      Layers:
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:google-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, GoogleAdsLayerVersion]}
        - arn:aws:lambda:us-east-1:${AWS::AccountId}:layer:bing-ads-layer-:${Fn::FindInMap:[LayerVersions, !Ref stage, BingAdsLayerVersion]}

  GoogleAdsEditorAdPerformanceAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdPerformanceLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdPerformanceAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdPerformanceLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorCustomerConversionAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCustomerConversionLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorCustomerConversionAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCustomerConversionLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAdGroupPerformanceAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupPerformanceLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdGroupPerformanceAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupPerformanceLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorKeywordPerformanceAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordPerformanceLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorKeywordPerformanceAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordPerformanceLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAccountAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAccountLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAccountAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAccountLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAdAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAdGroupAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAdGroupAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAdGroupLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorCampaignAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCampaignLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorCampaignAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorCampaignLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAssetAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAssetAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAssetSetAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetSetLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorAssetSetAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorAssetSetLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorFeedAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorFeedAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorFeedItemAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedItemLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorFeedItemAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorFeedItemLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorKeywordAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorKeywordAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorKeywordLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorSharedSetAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorSharedSetAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorSharedSetKeywordAliasStage:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetKeywordLambda
      FunctionVersion: $LATEST
      Name: stage

  GoogleAdsEditorSharedSetKeywordAliasProd:
    Type: AWS::Lambda::Alias
    Condition: CreateProdResources
    Properties:
      FunctionName:
        Ref: GoogleAdsEditorSharedSetKeywordLambda
      FunctionVersion: $LATEST
      Name: prod

  GoogleAdsEditorAccountFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAccount
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAccount
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/account/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/account/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAccountLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAccountLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAccountLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/account-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/account-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAd
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAd
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAdLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAdLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorCampaignFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleCampaign
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleCampaign
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/campaign/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/campaign/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorCampaignLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleCampaignLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleCampaignLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/campaign-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/campaign-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdGroupFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAdGroup
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAdGroup
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad-group/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad-group/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAdGroupLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAdGroupLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAdGroupLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/ad-group-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/ad-group-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAssetFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAsset
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAsset
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i

  GoogleAdsEditorAssetLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAssetLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAssetLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'
      Tags:
        - Key: map-migrated
          Value: d-server-0172k7rzjqh68i

  GoogleAdsEditorAssetSetFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAssetSet
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAssetSet
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset-set/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset-set/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAssetSetLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleAssetSetLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleAssetSetLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/asset-set-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/asset-set-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleFeed
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleFeed
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleFeedLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleFeedLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedItemFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleFeedItem
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleFeedItem
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed-item/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed-item/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorFeedItemLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleFeedItemLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleFeedItemLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/feed-item-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/feed-item-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorKeywordFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleKeyword
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleKeyword
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/keyword/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/keyword/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorKeywordLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleKeywordLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleKeywordLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/keyword-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/keyword-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleSharedSet
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleSharedSet
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetKeywordFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleSharedSetKeyword
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleSharedSetKeyword
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set-keyword/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set-keyword/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleSharedSetLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleSharedSetLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorSharedSetKeywordLogFirehose:
    Type: AWS::KinesisFirehose::DeliveryStream
    Properties:
      DeliveryStreamName: googleSharedSetKeywordLog
      DeliveryStreamType: DirectPut
      ExtendedS3DestinationConfiguration:
        BucketARN: arn:aws:s3:::data.ihsadvantage
        BufferingHints:
          IntervalInSeconds: 300
          SizeInMBs: 5
        CloudWatchLoggingOptions:
          Enabled: true
          LogGroupName: /aws/kinesisfirehose/googleSharedSetKeywordLog
          LogStreamName: S3Delivery
        CompressionFormat: GZIP
        ErrorOutputPrefix: 'json/errors/google/shared-set-keyword-log/error_type=!{firehose:error-output-type}/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        Prefix: 'json/google/shared-set-keyword-log/partition_date=!{timestamp:yyyy}-!{timestamp:MM}-!{timestamp:dd}/'
        RoleARN: 'arn:aws:iam::${AWS::AccountId}:role/firehose_delivery_role'

  GoogleAdsEditorAccountEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_account/stream/2019-11-11T18:32:09.876'
      FunctionName:
        Ref : GoogleAdsEditorAccountAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAccountErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorAccountV1 lambda'
      AlarmName: GoogleAdsEditorAccountFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorAccountV1
        - Name: Resource
          Value: !Sub googleAdsEditorAccountV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAdEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_ad/stream/2019-10-01T17:16:31.643'
      FunctionName:
        Ref : GoogleAdsEditorAdAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAdErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorAdV1 lambda'
      AlarmName: GoogleAdsEditorAdFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorAdV1
        - Name: Resource
          Value: !Sub googleAdsEditorAdV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAdGroupEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_ad_group/stream/2019-09-26T15:35:28.502'
      FunctionName:
        Ref : GoogleAdsEditorAdGroupAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAdGroupErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorAdGroupV1 lambda'
      AlarmName: GoogleAdsEditorAdGroupFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorAdGroupV1
        - Name: Resource
          Value: !Sub googleAdsEditorAdGroupV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorCampaignEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_campaign/stream/2019-10-24T20:32:48.705'
      FunctionName:
        Ref : GoogleAdsEditorCampaignAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorCampaignErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorCampaignV1 lambda'
      AlarmName: GoogleAdsEditorCampaignFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorCampaignV1
        - Name: Resource
          Value: !Sub googleAdsEditorCampaignV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAssetEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_asset/stream/2022-05-10T14:06:27.602'
      FunctionName:
        Ref : GoogleAdsEditorAssetAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAssetErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorAssetV1 lambda'
      AlarmName: GoogleAdsEditorAssetFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorAssetV1
        - Name: Resource
          Value: !Sub googleAdsEditorAssetV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAssetSetEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_asset_set/stream/2022-05-15T13:14:05.887'
      FunctionName:
        Ref : GoogleAdsEditorAssetSetAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorAssetSetErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorAssetSetV1 lambda'
      AlarmName: GoogleAdsEditorAssetSetFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorAssetSetV1
        - Name: Resource
          Value: !Sub googleAdsEditorAssetSetV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorFeedEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_feed/stream/2020-02-06T19:38:26.262'
      FunctionName:
        Ref : GoogleAdsEditorFeedAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorFeedErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorFeedV1 lambda'
      AlarmName: GoogleAdsEditorFeedFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorFeedV1
        - Name: Resource
          Value: !Sub googleAdsEditorFeedV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorFeedItemEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_feed_item/stream/2020-02-06T19:38:22.730'
      FunctionName:
        Ref : GoogleAdsEditorFeedItemAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorFeedItemErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorFeedItemV1 lambda'
      AlarmName: GoogleAdsEditorFeedItemFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorFeedItemV1
        - Name: Resource
          Value: !Sub googleAdsEditorFeedItemV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorKeywordEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_keyword/stream/2019-09-26T15:35:24.330'
      FunctionName:
        Ref : GoogleAdsEditorKeywordAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorKeywordErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorKeywordV1 lambda'
      AlarmName: GoogleAdsEditorKeywordFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorKeywordV1
        - Name: Resource
          Value: !Sub googleAdsEditorKeywordV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorSharedSetEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_shared_set/stream/2019-09-12T16:17:57.853'
      FunctionName:
        Ref : GoogleAdsEditorSharedSetAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorSharedSetErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorSharedSetV1 lambda'
      AlarmName: GoogleAdsEditorSharedSetFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorSharedSetV1
        - Name: Resource
          Value: !Sub googleAdsEditorSharedSetV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorSharedSetKeywordEventSource:
    Type: AWS::Lambda::EventSourceMapping
    Condition: CreateProdResources
    Properties:
      BatchSize: 50
      Enabled: True
      EventSourceArn: 'arn:aws:dynamodb:us-east-1:${AWS::AccountId}:table/google_shared_set_keyword/stream/2019-09-12T16:17:54.640'
      FunctionName:
        Ref : GoogleAdsEditorSharedSetKeywordAliasProd
      StartingPosition: LATEST

  GoogleAdsEditorSharedSetKeywordErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorSharedSetKeywordV1 lambda'
      AlarmName: GoogleAdsEditorSharedSetKeywordFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorSharedSetKeywordV1
        - Name: Resource
          Value: !Sub googleAdsEditorSharedSetKeywordV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorCustomerConversionEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads customer conversion report from Google Ads and reports issues
      Name: GoogleCustomerConversionReport
      ScheduleExpression: cron(0 21 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorCustomerConversionAliasProd
        Id: googleCustomerConversionReport
        Input: '{"daysAgo" : 1}'
  GoogleAdsEditorAdGroupPerformanceCurrentEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads today's ad group performance report from Google Ads
      Name: GoogleAdGroupPerformanceReportCurrent
      ScheduleExpression: cron(0/21 0,1,2,3,12,13,14,15,16,17,18,19,20,21,22,23 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorAdGroupPerformanceAliasProd 
        Id: googleAdGroupPerformanceReport
        Input: '{"daysAgo" : 0}'
  GoogleAdsEditorAdGroupPerformanceEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads ad group performance report from Google Ads
      Name: GoogleAdGroupPerformanceReport
      ScheduleExpression: cron(0 11 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorAdGroupPerformanceAliasProd
        Id: googleAdGroupPerformanceReport
        Input: '{"daysAgo" : 1}'
  GoogleAdsEditorAdPerformanceEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads ad performance report from Google Ads
      Name: GoogleAdPerformanceReport
      ScheduleExpression: cron(0 11 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorAdPerformanceAliasProd 
        Id: googleAdPerformanceReport
        Input: '{"daysAgo" : 1}'
    Type: AWS::Events::Rule
  GoogleAdsEditorKeywordPerformanceEvent:
    Type: AWS::Events::Rule
    Condition: CreateProdResources
    Properties:
      Description: Downloads keyword performance report from Google Ads
      Name: GoogleKeywordPerformanceReport
      ScheduleExpression: cron(0 11 * * ? *)
      State: ENABLED
      Targets:
      - Arn:
          Ref: GoogleAdsEditorKeywordPerformanceAliasProd
        Id: googleKeywordPerformanceReport
        Input: '{"daysAgo" : 1}'
    Type: AWS::Events::Rule
  GoogleAdsEditorCustomerConversionLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorCustomerConversionAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorCustomerConversionEvent
        - Arn
  GoogleAdsEditorAdGroupPerformanceCurrentLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorAdGroupPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorAdGroupPerformanceCurrentEvent 
        - Arn
  GoogleAdsEditorAdGroupPerformanceLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorAdGroupPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorAdGroupPerformanceEvent
        - Arn
  GoogleAdsEditorAdPerformanceLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorAdPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorAdPerformanceEvent
        - Arn
  GoogleAdsEditorKeywordPerformanceLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: CreateProdResources
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref GoogleAdsEditorKeywordPerformanceAliasProd
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - GoogleAdsEditorKeywordPerformanceEvent
        - Arn

  GoogleAdsEditorAdGroupPerformanceErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorAdGroupPerformance lambda'
      AlarmName: GoogleAdsEditorAdGroupPerformanceFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorAdGroupPerformanceV1
        - Name: Resource
          Value: !Sub googleAdsEditorAdGroupPerformanceV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 3600
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorAdPerformanceErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorAdPerformance lambda'
      AlarmName: GoogleAdsEditorAdPerformanceFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorAdPerformanceV1
        - Name: Resource
          Value: !Sub googleAdsEditorAdPerformanceV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 3600
      Statistic: Maximum
      Threshold: 0
      Unit: Count

  GoogleAdsEditorKeywordPerformanceErrorAlert:
    Type: AWS::CloudWatch::Alarm
    Condition: CreateProdResources
    Properties:
      ActionsEnabled: true
      AlarmActions:
        - arn:aws:sns:us-east-1:${AWS::AccountId}:PublicAlert
      AlarmDescription: 'Failure on googleAdsEditorKeywordPerformance lambda'
      AlarmName: GoogleAdsEditorKeywordPerformanceFailure
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value: !Sub googleAdsEditorKeywordPerformanceV1
        - Name: Resource
          Value: !Sub googleAdsEditorKeywordPerformanceV1:prod
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 3600
      Statistic: Maximum
      Threshold: 0
      Unit: Count
